import Head from "next/head";
import Image from "next/image";
import { db } from "@/settings/firebase/firebase.setup";
import { getDocs,collection,query,orderBy } from "firebase/firestore";
import Card from '@mui/material/Card';
import CardActions from '@mui/material/CardActions';
import CardContent from '@mui/material/CardContent';
import Button from '@mui/material/Button';
import Typography from '@mui/material/Typography';
import { numberWithCommas } from "@/utilities/numberWithCommas";

export async function getStaticProps() {
    const jobs = [];

    const q = query(collection(db,'jobs'),orderBy('timestamp','desc'))
    const onSnap = await getDocs(q);

    onSnap.forEach(document => {
        jobs.push({
            id:document.id,
            data:document.data(),
        })
    })

    return {
        props: {
            jobsData:jobs
        }
    }
} 

export default function Jobs ({jobsData}) {
    return (
        <>
        <Head>
            <title>Jobs | Real Fast</title>
            <meta name="description" content="Generated by create next app" />
            <meta name="viewport" content="width=device-width, initial-scale=1" />
            <link rel="icon" href="/realfast_logo.png" />
        </Head>
        <main className={styles.container}>
            <h1 className="text-3xl mb-4">Recent jobs</h1>

            <div className="flex flex-col gap-3">
                {
                    jobsData.map(item => {
                        return (
                            <Card sx={{ minWidth: 280 }}>
                                <CardContent>
                                    <Typography sx={{ fontSize: 14 }} color="text.secondary" gutterBottom>
                                    Word of the Day
                                    </Typography>
                                    <Typography variant="h5" component="div">
                                    {item.data.title}
                                    </Typography>
                                    <Typography sx={{ mb: 1.5 }} color="text.secondary">
                                    â‚¦{numberWithCommas(item.data.wages)}
                                    </Typography>
                                    <div className=" flex gap-3 grid-cols-3">
                                        <Image src={item.data.coverImage ? item.data.coverImage : '/images/error-404.png'} alt={item.data.title} width={480} height={360}/>
                                        <div className="col-span-2">
                                            <Typography variant="body2">
                                            {item.data.desc}
                                            </Typography>
                                        </div>
                                    </div>
                                </CardContent>
                                <CardActions>
                                    <Button href={'jobs/'+item.data.url} size="small" variant="contained">View Job</Button>
                                </CardActions>
                            </Card>
                        )
                    })
                }
            </div>
        </main>
        </>
    )
}

const styles = {
    container:'w-full px-16 py-8',
}